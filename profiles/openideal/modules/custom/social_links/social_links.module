<?php

define('FB_LIKE', '<iframe src="//www.facebook.com/plugins/like.php?href&amp;send=false&amp;layout=button_count&amp;width=450&amp;show_faces=false&amp;action=like&amp;colorscheme=light&amp;font&amp;height=21&amp; scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:450px; height:21px;" allowTransparency="true"></iframe>');
define('TWITTER', '<a href="https://twitter.com/share" class="twitter-share-button">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>');
define('GOOGLEPLUS', '<div class="g-plusone" data-size="medium"></div><script>(function() {var po = document.createElement("script"); po.type = "text/javascript"; po.async = true;po.src = "https://apis.google.com/js/plusone.js";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(po, s);})();</script>');
define('LINKEDIN', '<script src="//platform.linkedin.com/in.js" type="text/javascript"></script><script type="IN/Share" data-counter="right"></script>');

/**
 * Implementation of hook_field_info().
 */
function social_links_field_info() {
  return array(
    'social_links' => array(
      'label' => t('Social Links'),
      'description' => t('Store a social links difinition for this piece of content.'),
      'default_widget' => 'social_links_exposed',
      'default_formatter' => 'social_links_formatter_default',
    ),
  );
}

/**
 * Implementation of hook_field_widget_info().
 */
function social_links_field_widget_info() {
  return array(
    'social_links_exposed' => array(
      'label' => t('Social Links'),
      'field types' => array('social_links'),
      'behaviors' => array('multiple values' => FIELD_BEHAVIOR_NONE),
    ),
  );
}

/**
 * Implements hook_field_prepare_view().
 * 
 * Must populate items, for force rendering the output.
 */
function social_links_field_prepare_view($entity_type, $entities, $field, $instances, $langcode, &$items) {
  foreach ($entities as $id => $entity) {
    if (empty($items[$id])) {
      $items[$id] =  array(0);
    }
  }
}

/**
 * Implements hook_field_instance_settings_form().
 */
function social_links_field_instance_settings_form($field, $instance) {
  $form = array();
  
  $form['description'] = array(
    '#type' => 'item',
    '#title' => t('Paset your desire buttons code in the text areas below.'),  
    '#markup' => t('Get your Facebook Like button !here.', array('!here' => '<a href="http://developers.facebook.com/docs/reference/plugins/like" target="_blank">here</a>')) . "<br />" .
      t('Get your Twitter Share button !here.', array('!here' => '<a href="http://twitter.com/about/resources/buttons#tweet" target="_blank">here</a>')) . "<br />" .
      t('Get your Google+ button !here.', array('!here' => '<a href="http://www.google.com/webmasters/+1/button/" target="_blank">here</a>')) . "<br />" .
      t('Get your Linkedin Share button !here.', array('!here' => '<a href="https://developer.linkedin.com/plugins/share-plugin-generator" target="_blank">here</a>')),
  );

  $form['link1'] = array(
    '#type' => 'textarea',
    '#title' => t('1st button code'),
    '#default_value' => isset($instance['settings']['link1']) ? $instance['settings']['link1'] : FB_LIKE,
  );
  $form['link2'] = array(
    '#type' => 'textarea',
    '#title' => t('2nd button code'),
    '#default_value' => isset($instance['settings']['link2']) ? $instance['settings']['link2'] : TWITTER ,
  );
  $form['link3'] = array(
    '#type' => 'textarea',
    '#title' => t('3rdr button code'),
    '#default_value' => isset($instance['settings']['link3']) ? $instance['settings']['link3'] : GOOGLEPLUS,
  );
  $form['link4'] = array(
    '#type' => 'textarea',
    '#title' => t('4th button code'),
    '#default_value' => isset($instance['settings']['link4']) ? $instance['settings']['link4'] : LINKEDIN,
  );
  $form['link5'] = array(
    '#type' => 'textarea',
    '#title' => t('5th button code'),
    '#default_value' => isset($instance['settings']['link5']) ? $instance['settings']['link5'] : '',
  );
  $form['link6'] = array(
    '#type' => 'textarea',
    '#title' => t('6th button code'),
    '#default_value' => isset($instance['settings']['link6']) ? $instance['settings']['link6'] : '',
  );

  return $form;
}

/**
 * Implements hook_field_formatter_info().
 */
function social_links_field_formatter_info() {
  return array(
    'social_links_formatter_default' => array(
      'label' => t('Social Links (default)'),
      'field types' => array('social_links'),
    ),
  );
}

/**
 * Implements of hook_field_formatter_view().
 */
function social_links_field_formatter_view($entity_type, $entity, $field, $instance, $langcode, $items, $display) {
  $element = array();
  
  foreach ($instance['settings'] as $vendor => $button) {
    if (!empty($button)) {
      $buttons[] = $button;
    }  
  }

  $element[0] = array('#markup' => theme('social_links', $buttons));
  return $element;
}

/**
 * Implements of hook_theme().
 */
function social_links_theme($existing, $type, $theme, $path) {
  return array(
   'social_links' => array(
      'variables' => array('buttons' => NULL),
    ),  
  ); 
}

/**
 * Theme function for display social links.
 */
function theme_social_links($buttons) {
  $output = '';
  foreach ($buttons as $button) {
    if (!empty($button)) {
      $output .=  "<span>{$button}</span>";
    }
  }

  return $output;
}